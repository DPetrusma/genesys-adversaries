"use strict";System.register(["react","remarkable","lib/utils","lib/string","lib/list","lib/config"],function(_export,_context){"use strict";var React,Remarkable,dice,symbolise,minionSkill,id,sortByProperty,CONFIG,_createClass,PanelWeapons;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function getWeaponDetails(weapon,character,allSkills,aliveMinions){if(!("id"in weapon)){weapon.id=id(weapon.name)}// melee weapon so work out brawn damage
if("plus-damage"in weapon){weapon["damage"]=weapon["plus-damage"]+character.characteristics.Brawn}if(!("qualities"in weapon)){weapon.qualities=[]}// get dice values
var skill=allSkills.find(function(s){return s.name==weapon.skill});if(skill==null){weapon.images=[];return weapon}var stat=character.characteristics[skill.characteristic]||0;var value=character.skills[weapon.skill]||0;if(character.type==CONFIG.MINION){value=minionSkill(aliveMinions,weapon.skill,character.skills)}weapon.icons=dice(stat,value);// add any notes as a quality
if("notes"in weapon&&weapon.qualities.indexOf("Notes")==-1){weapon.qualities.push("Notes")}weapon.qualities.sort();return weapon}return{setters:[function(_react){React=_react.default},function(_remarkable){Remarkable=_remarkable.default},function(_libUtils){dice=_libUtils.dice;symbolise=_libUtils.symbolise;minionSkill=_libUtils.minionSkill},function(_libString){id=_libString.id},function(_libList){sortByProperty=_libList.sortByProperty},function(_libConfig){CONFIG=_libConfig}],execute:function(){_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();PanelWeapons=function(_React$Component){_inherits(PanelWeapons,_React$Component);function PanelWeapons(props){_classCallCheck(this,PanelWeapons);var _this=_possibleConstructorReturn(this,(PanelWeapons.__proto__||Object.getPrototypeOf(PanelWeapons)).call(this,props));_this.state={quality:null};_this.md=new Remarkable;return _this}_createClass(PanelWeapons,[{key:"setQuality",value:function setQuality(evt){var name=evt.target.innerText.replace(/\s\d{1,}$/,"");var quality=null;if(name=="Notes"){var _id=evt.target.getAttribute("data-weapon");var weapon=this.props.weapons.all().concat(this.props.character.weapons).find(function(w){return w.id==_id});quality={name:"Notes",type:"",description:weapon.notes}}else{var allQualities=this.props.qualities.all().concat(this.props.talents.all());quality=allQualities.find(function(q){return q.name==name})}if(quality){this.setState({quality:quality})}}},{key:"hideQuality",value:function hideQuality(evt){this.setState({quality:null})}},{key:"componentWillUpdate",value:function componentWillUpdate(nextProps,nextState){if(nextProps.character!==this.props.character){this.setState({quality:null})}}},{key:"render",value:function render(){var _this2=this;if(this.props.character==null){return null}var character=this.props.character;var weapons=[];var allWeapons=this.props.weapons!=null?this.props.weapons.all():null;var allSkills=this.props.skills!=null?this.props.skills.all():null;if(allWeapons==null||allSkills==null){return null}if(character.weapons!=null){character.weapons.forEach(function(w){var weapon=w instanceof Object?w:allWeapons.find(function(a){return a.name==w});if(!weapon){return null}weapons.push(getWeaponDetails(weapon,character,allSkills,_this2.props.aliveMinions))});weapons.sort(sortByProperty("name"))}return React.createElement("div",{className:"info"},React.createElement("h2",null,"Weapons"),weapons.length==0?React.createElement("p",null,"\u2013"):React.createElement("table",{className:"weapons"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Weapon"),React.createElement("th",null,"Range"),React.createElement("th",null,"Damage"),React.createElement("th",{className:"hide-small hide-medium"},"Roll ",character.type==CONFIG.MINION?React.createElement("small",null," (for ",this.props.minions,")"):null),React.createElement("th",null,"Qualities / Mods"))),React.createElement("tbody",null,weapons.map(function(w){return React.createElement("tr",{key:w.id},React.createElement("td",null,w.name,React.createElement("br",null),React.createElement("small",null,w.skill)),React.createElement("td",null,React.createElement("small",null,w.range)),React.createElement("td",null,React.createElement("div",{className:"damage"},React.createElement("small",{className:"hide-small"},"Damage:")," ",w.damage||"\u2013"),React.createElement("div",{className:"damage"},React.createElement("small",{className:"hide-small"},"Critical:")," ",w.critical||"\u2013")),React.createElement("td",{className:"hide-small hide-medium",dangerouslySetInnerHTML:w.icons}),React.createElement("td",null,w.qualities.length==0?"\u2013":w.qualities.map(function(q){return React.createElement("div",{key:id(q)},React.createElement("span",{className:"link",onClick:_this2.setQuality.bind(_this2),"data-weapon":w.id},q))})))}))),this.state.quality!=null?React.createElement("div",{className:"quality"},React.createElement("h3",null,this.state.quality.name," ",this.state.quality.name=="Notes"?"":React.createElement("small",null,"(",this.state.quality.type||"Passive",")")),this.state.quality.description.split("\n\n").map(function(l,i){return React.createElement("p",{key:i,dangerouslySetInnerHTML:symbolise(_this2.md.render(l))})}),React.createElement("div",{className:"text-right"},React.createElement("small",{className:"btn",onClick:this.hideQuality.bind(this)},React.createElement("span",{className:"fa fa-close"})," Close"))):null)}}]);return PanelWeapons}(React.Component);_export("default",PanelWeapons)}}});