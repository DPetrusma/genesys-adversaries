"use strict";System.register(["react","lib/dispatcher","lib/config","lib/list","lib/string","lib/utils"],function(_export,_context){"use strict";var React,dispatcher,CONFIG,sortByProperty,id,book,_slicedToArray,_createClass,TagMenu;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function titlecase(s){return s[0].toUpperCase()+s.substring(1).toLowerCase()}return{setters:[function(_react){React=_react.default},function(_libDispatcher){dispatcher=_libDispatcher.default},function(_libConfig){CONFIG=_libConfig},function(_libList){sortByProperty=_libList.sortByProperty},function(_libString){id=_libString.id},function(_libUtils){book=_libUtils.book}],execute:function(){_slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();TagMenu=function(_React$Component){_inherits(TagMenu,_React$Component);function TagMenu(){var _ref;_classCallCheck(this,TagMenu);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var _this=_possibleConstructorReturn(this,(_ref=TagMenu.__proto__||Object.getPrototypeOf(TagMenu)).call.apply(_ref,[this].concat(args)));_this.listener=null;_this.menu={};_this.state={active:null};return _this}_createClass(TagMenu,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var _this2=this;this.menu={};nextProps.tags.forEach(function(tag){var type="tag";var text=tag;if(tag.indexOf(":")!=-1){var _tag$split=tag.split(":");var _tag$split2=_slicedToArray(_tag$split,2);type=_tag$split2[0];text=_tag$split2[1];if(type=="book"){text=book(tag)}}if(!(type in _this2.menu)){_this2.menu[type]=[]}_this2.menu[type].push({text:text,tag:tag})});Object.keys(this.menu).forEach(function(m){return _this2.menu[m].sort(sortByProperty("text"))})}},{key:"componentDidMount",value:function componentDidMount(){var _this3=this;this.listener=document.addEventListener("click",function(){_this3.setState({active:null})},false)}},{key:"componentWillUnmount",value:function componentWillUnmount(){document.removeEventListener("click",this.listener)}},{key:"handler",value:function handler(evt){var tag=evt.target.getAttribute("data-href");if(tag.startsWith(CONFIG.FAVOURITE_KEY)){dispatcher.dispatch(CONFIG.OBJECT_VIEW,id(tag.replace(CONFIG.FAVOURITE_KEY,"")))}else{dispatcher.dispatch(CONFIG.MENU_FILTER,tag.toLowerCase())}this.setState({active:null})}},{key:"openMenu",value:function openMenu(evt){evt.stopPropagation();evt.nativeEvent.stopImmediatePropagation();var oldActive=this.state.active;var newActive=evt.target.getAttribute("data-menu");this.setState({active:oldActive==newActive?null:newActive})}},{key:"render",value:function render(){var _this4=this;return React.createElement("div",{id:"menu"},React.createElement("em",null,"Genesys: Adversaries"),React.createElement("ul",null,Object.keys(this.menu).sort().map(function(m){return React.createElement("li",{className:_this4.state.active==m?"active":"",key:m},React.createElement("div",{"data-menu":m,onClick:_this4.openMenu.bind(_this4)},titlecase(m)," ",React.createElement("svg",{"data-menu":m},React.createElement("use",{xlinkHref:"#icon-circle-down"}))),React.createElement("ul",null,_this4.menu[m].map(function(t){return React.createElement("li",{key:t.tag},React.createElement("span",{className:"link",onClick:_this4.handler.bind(_this4),"data-href":t.tag},t.text))})))})))}}]);return TagMenu}(React.Component);_export("default",TagMenu)}}});